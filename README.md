# method-param-static-analysis
A basic static analysis which raises a warning if a method has more than 3 parameters.

## Table of contents
* **[Initial Setup](#Initial-Setup)**
* **[Running Static Analysis](#Running-Static-Analysis)**
* **[Tested On Repositories](#tested-on-repositories)**


## INITIAL SETUP 


### Download the sources

If clang, llvm and clang-tidy is not setup, run the below commands in order:

```
# download the sources 
$ git clone http://llvm.org/git/llvm.git 
$ cd llvm/tools/
$ git clone http://llvm.org/git/clang.git
$ cd clang/tools/
$ git clone http://llvm.org/git/clang-tools-extra.git extra
```
This has source code for clang, llvm and clang-tidy.


```
# build everything
$ cd ../../../
$ mkdir build && cd build/
# see http://llvm.org/docs/CMake.html#options-and-variables for details on the cmake build process of LLVM
$ cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo ..
$ make check-clang-tools
$ export PATH=$PWD/bin:$PATH

```

### Now we are all set with LLVM, Clang and Clang-tidy  

```
# Let's setup our custom static analyser. Go to clang tidy folder by the follwing command:
% cd ../tools/clang/tools/extra/clang-tidy

# Adding Scaffolding
$  cd llvm/tools/clang/tools/extra/clang-tidy
$  ./add_new_check.py misc more-than-three-parameters
$  cd misc
```
Now replace the contents of **autogenerated** "MoreThanThreeParametersCheck.cpp" file with the contents of our custom static analysis cpp file **in this repository** (link below) :

https://github.com/kanfspfsp/method-param-static-analysis/blob/master/MoreThanThreeParametersCheck.cpp

```
#  After re run the below make command
$  make check-clang-tools

#Ignore any failed tests

# Now finally run the static analysis on any cpp file:
$  clang-tidy -checks='-*,misc-more-than-three-parameters' /any/problematic.cpp
```


## RUNNING STATIC ANALYSIS

Consider a test c++ file, which has the code like:

```
#include <stdio.h>

struct A {

    int add2Numbers(int a,int b)
    {
        return a+b;
    }
    int add4Numbers(int a,int b, int c, int d)
    {
        return a+b+c+d;

    }
    int add5number(int a,int b, int c, int d, int e)
    {
        return a+b+c+d+e;
    }
};
```
If we run the below command for the test file above

```
$ clang-tidy -checks='-*,misc-more-than-three-parameters' /some/path/test.cpp
```
The "-*" removes all the other checks and adds the custom check that I have developed named: misc-more-than-three-parameters.

Output:

```
Running without flags.
2 warnings generated.
/Users/kanfspfsp/Desktop/test.cpp:9:9: warning: Method has more than 3 Parameters [misc-more-than-three-parameters]
int add4Numbers(int a,int b, int c, int d)
^
/Users/kanfspfsp/Desktop/test.cpp:14:9: warning: Method has more than 3 Parameters [misc-more-than-three-parameters]
int add5number(int a,int b, int c, int d, int e)
```

This output throws a warning for only those functions which have more than 3 parameters.





## TESTED ON REPOSITORIES

I have tested this custom static analysis on a few famous github repositories: 

Below are the links to the warning output files generated.

MongoDB : https://github.com/mongodb/mongo   -
> Report: mongodb.out (https://github.com/kanfspfsp/method-param-static-analysis/blob/master/mongodb.out)

Facebook hhvm : https://github.com/facebook/hhvm
> Report: hhvm.out (https://github.com/kanfspfsp/method-param-static-analysis/blob/master/hhvm.out)

Godot Game Engine: https://github.com/godotengine/godot
> Report: godot.out (https://github.com/kanfspfsp/method-param-static-analysis/blob/master/godot.out)


The command I used to generate run static analysis report through repositories:

```
find . -iname *.h -o -iname *.cpp | xargs clang-tidy -checks='-*,misc-more-than-three-parameters' | grep -A 2  "warning: Method has more than 3 Parameters"
```
